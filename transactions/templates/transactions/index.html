{% extends 'base.html' %}

{% block title %}Daftar Transaksi{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Daftar Transaksi</h1>
        <a href="{% url 'transaction_export' %}" class="btn btn-secondary" id="export-btn">Ekspor ke CSV</a>
    </div>

    <form action="{% url 'transaction_add' %}" method="post" class="mb-5 p-4 bg-light rounded border">
        {% csrf_token %}
        <div class="row g-3">
            <div class="col-md-4">
                <select name="wallet" class="form-select" required>
                    <option value="">Pilih Dompet...</option>
                    {% for wallet in wallets %}
                        <option value="{{ wallet.pk }}">{{ wallet.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <input list="payee-list" name="payee" class="form-control" placeholder="Bayar ke/Terima dari..."
                       required>
                <datalist id="payee-list">
                    {% for payee in payees %}
                        <option value="{{ payee.name }}">
                    {% endfor %}
                </datalist>

            </div>
            <div class="col-md-4">
                <select name="category" class="form-select" required>
                    <option value="">Pilih Kategori...</option>
                    {% for category in categories %}
                        <option value="{{ category.pk }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text">Rp</span>
                    <input type="number" name="amount" class="form-control" placeholder="Jumlah" step="0.01" required>
                </div>
            </div>
            <div class="col-md-4">
                <select name="transaction_type" class="form-select" required>
                    <option value="PENGELUARAN">Pengeluaran</option>
                    <option value="PEMASUKAN">Pemasukan</option>
                </select>
            </div>
            <div class="col-md-4">
                <input type="date" name="transaction_date" class="form-control" required>
            </div>
        </div>
        <div class="d-grid gap-2 mt-3">
            <button type="submit" class="btn btn-primary">Tambah Transaksi</button>
        </div>
    </form>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Tanggal</th>
                <th>Tipe</th>
                <th>Penerima/Tujuan</th>
                <th>Kategori</th>
                <th class="text-end">Jumlah</th>
                <th class="text-center">Aksi</th>
            </tr>
            </thead>
            <tbody>
            {% for tx in transactions %}
                <tr>
                    <td>{{ tx.transaction_date|date:"d M Y" }}</td>
                    <td>{{ tx.get_transaction_type_display }}</td>
                    <td>{{ tx.payee.name|default:"-" }}</td>
                    <td>{{ tx.category.name|default:"-" }}</td>
                    <td class="text-end">Rp {{ tx.amount|floatformat:0 }}</td>
                    <td class="text-center">
                        <a href="{% url 'transaction_update' tx.pk %}" class="btn btn-sm btn-outline-primary">Edit</a>
                        <form action="{% url 'transaction_delete' tx.pk %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger">Hapus</button>
                        </form>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" class="text-center p-4">Belum ada transaksi.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}